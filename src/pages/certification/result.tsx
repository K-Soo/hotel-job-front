import React from 'react';
import { GetServerSideProps, InferGetServerSidePropsType, GetServerSidePropsContext } from 'next';
import { parseBody } from 'next/dist/server/api-utils/node/parse-body';
import Image from 'next/image';
import environment from '@/environment';

// phone_no: '',
// res_msg: '����ó��',
// DI: '',
// year: '0',
// user_name_url_yn: '',
// cert_otp_use: 'N',
// CI_ENC_YN: '',
// comm_id: 'SKT',
// sex_code: '',
// safe_guard_yn: 'N',
// PRE_USE_YN: 'N',
// day: '0',
// site_key: '',
// web_siteid_hashYN: 'Y',
// dn_hash: '06C871A425F6E7E849402751BDA1626583E0DBD7',
// res_cd: '0000',
// DI_URL: '',
// month: '0',
// site_url: 'www.hotel-job-connect.com',
// Ret_URL: 'https://hotel-job-connect.com/certification/result',
// kcp_merchant_time: '',
// info_code: '54C5E32A26BF3C878F4C4FABC315EE1B',
// user_name: '',
// server_hash: '',
// cert_02_yn: 'Y',
// log_trace_no: 'AKWH3BJa1wVnOBJp',
// param_opt_1: 'opt1',
// Ret_Noti: '',
// reg_dt: '',
// param_opt_3: 'opt3',
// param_opt_2: 'opt2',
// cert_enc_use: 'Y',
// enc_cert_data2: '.1.62BF722823C8704D146C4B4A6D4F3399AD13ACB194AA6C939ACFA05C6D11EABFDFF0B8545B549ABD7A99C7339BA979D52675C36673E37DBB382450A3535F62DB8ACE45269FB61EAB41E987FCD42F4A04D3C68BA6BD673C9740A70E51E5FAC865007B2BDB0470A42AEFEC5D430F8047C2E6E441B632511E5D069875BE4F865FBE1A4942104F65931B17DB9483C08E6F117D071A0BDA3CE3929F4DFC0EA4B5409ECD22B355103447D5FF41A976AFADD4B8DB53A03DAE4ECD7F45EB251F7435D19E500774EC2DCAA7E47F9CEA079D59E0D5E1B39321A9477F02000C7928664689CE9B7A2A3B74D4F34DDA103523B76A50C5EA0AE492D19683A52F0D8919D1EB3A0D82B73B19BE8F9151F7E4D1DAA42E393108B2EE0EDD100D7ADDE3A42C8EA03369BAF13B6935AD38CB632BF5FB1C9FD55C1691AC796B995A085975A1DEC6E5888C73B559F58EABAA1641CC7941EBE96290B1EFD6F03F7DBBD62953903101B0762DD964310288BD1D21036836483268866AB11D9FB20708192C07768CF58B3825EC7B63E0F568BD5FA3E53969CF2FEAEE4C74BB6545E329EAD63B9E75503FFC1B67DC26C731D6DC098464EA6F26C86ABBB4FC1E5C16630A9F0FC7B5C2455F181EA0ECFABF25FC6D1A84A75ACF1EB917FEBCD2253D9E1F526DB4E7480A0E14D06EAF46F27A70BD75BD142B16BD13FDBF9E035350969E6F014FA43CEF57E26F6EBB7EF9643892A4B5464D9184B8A4540232D5193957202DD0ACF1D8EED47C23C1020863EC93355ECE7BE7DB61D0ADACFF25841EA3EADEDC7BC1478ACBC1F562CA79A97A5D80161CC8D406625D08539D7BF686B5F17F927C4C809258BB5DCD7C6297CBFC3538868305449A157D14815B696B2F6CBFC6DDE6899536621F057CC18CE589284690469DE44406B40F3A2AA682142F5D03788EE4952E148C7E4DECD5A9BD4A974B7E123D39E20A8AF5B05B7CDF0A1B6A553E647AE7B97C963E2878A23E4C9B4CEB268341B7155CE10AACD2043961060C578E113AD70B350BEB9C48F5F139CD533D42102D9C30F1874A5FAA51972278D68FC24068F723575503196AE4BE71AE578D09650E0DD53AB84897EA9516EB7815B03FB6CDAA804552172FDF781A6E157AE732270C894CF389064E2C6CE87DCDACE4D52979E89683BB238667C213AF93BCBB0419C16A7C9FF198D7C5B470962D8D6E6B7ABA1644413BBD6713BB823C711800E8CA2A2B4275265F80FCF402C41CCF91151A0A782FCBFC46395ADC648613BBC38951FA4BCE1C21C93F8B7BA8620D9EE6E11B7FA74A14EB2A3F59914479C9F275C53F0806518F9651886AB2C5688EC915F12A37A6E2473E19659F0A1C8F7432CCC9C64E2B53CF0EE687087AC340EB055BE780A76189D93455C59A6701806EDE1E42B6B3BD280CBA52AE0D25CA7DEA381332091F3B9CA85DE84EB065F66CB063C42A772E77D17113B57C897CA7447CE857EE11DCC4BB4FAF0C2789F1C04DF37382FA5687F715E377A4412DAB55505BCBC44B0A74C3ECA89390A7921424D72ACC53966381D31D88CE0B8B3AA5F2DAB126651B42DA6B04B821F06CAD464C91FFA34D0507771FF0F049CFBC60A3003224F8A46839201F36CD92F297C78215BCE4C18765474C10D76BBF08E025EA1D1D08A9223612D78B02EF50A49D7C3DFC13B9F5EDF7F8BF44CD8B7A79CB8057348F88E4E8E38240FF1C4CFD96D75BE156555474F3828A854F633222D6FD4A0ABDE26B63ED393B97DE1B9196BA7219EF8A4E935DEDA030822FBF340BA58902EE9655ABAEADE24025DDF236F96433B72BB9507B3974DCC2AA734F555C944446A4DEA303F08FD77EAD2B2C6EB1FF5804FC3A67A4DD57642419E680DBA2747DBE03D02BD13A5C8E4B818F3C7B4572B5626E47EFAF484EEA13C4DE9EFC369EC6B52893A346E269C0C8F23B98AF09AD2E0C72592EB2E694FC9FC19EFFE53C23E0DBAF7CFEDC2014A3125A7CEBB8C32966D2F76BEB84FA541711353DFAA60D43B5D3F5EBD5965A0503DBAD024D42BB0CA34271D00F5E1251C36EB5BA20372F5F067801759311106D628BF90BF4860EFF8CDF2ADF07B65A7211F800247A9D2AF375B2DB370CAC08888FFAD20AE4DA87F3E071D9C4EF21580A28B9E945E8013B51EADDEAAEE530599E2FF546A7FB349FB8A9072E1790CEF6F40022F4789372D903DD9E2A9E1DEEE0DDA08CD3CF8D7B02933E73FD8383A1.WNKSoWIQNTQGo6FgF1gS2AfUmxks1wreH67qTa-9qFy4-Pl65iInSS30jT2SWZZt_4DXYuQ6phEv5ghgGiXnuhydEEKxb_r27Kw-YneCibE-ZPEuCta3K5x_9Sk-PoFoUSXVR-1

export default function ResultCertificationPage({ result }: InferGetServerSidePropsType<typeof getServerSideProps>) {
  console.log('ResultCertificationPage: ', result);
  React.useEffect(() => {
    if (result) {
      window.parent?.postMessage(JSON.stringify({ type: 'CERTIFICATION_RESULT', data: result }), environment.baseUrl);
      window.close();
    }
  }, [result]);

  return (
    <section style={{ display: 'flex', justifyContent: 'center', alignItems: 'center', height: '100vh' }}>
      <Image src="/images/spinner200px.gif" width={30} height={30} alt="loading" priority />
    </section>
  );
}

export const getServerSideProps: GetServerSideProps = async (context: GetServerSidePropsContext) => {
  try {
    const body = await parseBody(context.req, '1mb');
    return {
      props: {
        result: body,
      },
    };
  } catch (error) {
    return {
      props: {
        result: null,
      },
    };
  }
};
